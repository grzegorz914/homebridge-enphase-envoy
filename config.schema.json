{
  "pluginAlias": "enphaseEnvoy",
  "pluginType": "platform",
  "singular": true,
  "fixArrays": true,
  "headerDisplay": "This plugin works with Enphase Photovoltaic system. Devices are exposed to HomeKit as separate accessories and each needs to be manually paired.",
  "footerDisplay": "For documentation please see [GitHub repository](https://github.com/grzegorz914/homebridge-enphase-envoy).",
  "schema": {
    "type": "object",
    "properties": {
      "devices": {
        "title": "Devices",
        "type": "array",
        "items": {
          "type": "object",
          "properties": {
            "name": {
              "title": "Name",
              "type": "string",
              "placeholder": "Accessory name",
              "description": "Here set the accessory name to be displayed in HomeKit.",
              "required": true
            },
            "host": {
              "title": "IP/Hostname",
              "type": "string",
              "placeholder": "IP Address or Hostname",
              "format": "hostname",
              "description": "Here set the envoy ip address/hostname or leave empty, will use default path envoy.local.",
              "required": false
            },
            "envoyFirmware7xx": {
              "title": "Firmware 7.x.x",
              "type": "boolean",
              "default": false,
              "description": "This enable support for Envoy with firmware 7.x.x and newer.",
              "required": true
            },
            "envoyFirmware7xxTokenGenerationMode": {
              "title": "Token Generation Mode",
              "type": "integer",
              "oneOf": [
                {
                  "title": "Enlighten User And Password",
                  "enum": [
                    0
                  ]
                },
                {
                  "title": "Your Own Generated Token",
                  "enum": [
                    1
                  ]
                }
              ],
              "description": "Here select how You wuld to obtain the Token.",
              "condition": {
                "functionBody": "return model.devices[arrayIndices].envoyFirmware7xx === true;"
              },
              "required": true
            },
            "envoyPasswd": {
              "title": "Envoy Password",
              "type": "string",
              "placeholder": "Envoy password",
              "description": "Here set the envoy password, only if You already changed the default password.",
              "condition": {
                "functionBody": "return model.devices[arrayIndices].envoyFirmware7xx === false;"
              },
              "required": false
            },
            "envoyToken": {
              "title": "Envoy Token",
              "type": "string",
              "placeholder": "Token",
              "description": "Here paste Your own Token.",
              "condition": {
                "functionBody": "return model.devices[arrayIndices].envoyFirmware7xx === true && model.devices[arrayIndices].envoyFirmware7xxTokenGenerationMode === 1;"
              },
              "required": false
            },
            "envoySerialNumber": {
              "title": "Envoy Serial Number",
              "type": "string",
              "placeholder": "Serial number",
              "description": "Here set the envoy serial number.",
              "condition": {
                "functionBody": "return model.devices[arrayIndices].envoyFirmware7xx === true && model.devices[arrayIndices].envoyFirmware7xxTokenGenerationMode === 0;"
              },
              "required": false
            },
            "enlightenUser": {
              "title": "Enlighten User",
              "type": "string",
              "placeholder": "user@enlighten.com",
              "description": "Here set the enlighten user name.",
              "condition": {
                "functionBody": "return model.devices[arrayIndices].envoyFirmware7xx === true && model.devices[arrayIndices].envoyFirmware7xxTokenGenerationMode === 0;"
              },
              "required": false
            },
            "enlightenPasswd": {
              "title": "Enlighten Password",
              "type": "string",
              "placeholder": "password",
              "description": "Here set the enlighten password.",
              "condition": {
                "functionBody": "return model.devices[arrayIndices].envoyFirmware7xx === true && model.devices[arrayIndices].envoyFirmware7xxTokenGenerationMode === 0;"
              },
              "required": false
            },
            "powerProductionSummary": {
              "title": "Power Summary",
              "type": "integer",
              "description": "Here set the power summary in (W) of all microinverters, based on this value the power production level will be calculated and displayed as (%) in HomeKit.",
              "required": false
            },
            "powerProductionStateSensor": {
              "title": "Power State Sensor",
              "type": "object",
              "properties": {
                "name": {
                  "title": "Name",
                  "type": "string",
                  "placeholder": "Sensor name",
                  "description": "Here set Your own sensor name.",
                  "required": false
                },
                "displayType": {
                  "title": "Type",
                  "type": "integer",
                  "minimum": 0,
                  "maximum": 3,
                  "oneOf": [
                    {
                      "title": "None/Disabled",
                      "enum": [
                        0
                      ]
                    },
                    {
                      "title": "Motion Sensor",
                      "enum": [
                        1
                      ]
                    },
                    {
                      "title": "Occupancy Sensor",
                      "enum": [
                        2
                      ]
                    },
                    {
                      "title": "Contact Sensor",
                      "enum": [
                        3
                      ]
                    }
                  ],
                  "description": "Select the sensor type to be displayed in HomeKit.",
                  "required": true
                }
              },
              "required": false
            },
            "powerProductionLevelSensors": {
              "title": "Sensors",
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "name": {
                    "title": "Name",
                    "type": "string",
                    "placeholder": "Sensor name",
                    "description": "Here set Your own sensor name.",
                    "required": false
                  },
                  "powerLevel": {
                    "title": "Power Level",
                    "type": "integer",
                    "minimum": 0,
                    "description": "Here set power level in (W) at which the sensor fired.",
                    "required": false
                  },
                  "displayType": {
                    "title": "Type",
                    "type": "integer",
                    "minimum": 0,
                    "maximum": 3,
                    "oneOf": [
                      {
                        "title": "None/Disabled",
                        "enum": [
                          0
                        ]
                      },
                      {
                        "title": "Motion Sensor",
                        "enum": [
                          1
                        ]
                      },
                      {
                        "title": "Occupancy Sensor",
                        "enum": [
                          2
                        ]
                      },
                      {
                        "title": "Contact Sensor",
                        "enum": [
                          3
                        ]
                      }
                    ],
                    "description": "Select the sensor type to be displayed in HomeKit.",
                    "required": true
                  }
                }
              },
              "required": false
            },
            "energyProductionStateSensor": {
              "title": "Energy State Sensor",
              "type": "object",
              "properties": {
                "name": {
                  "title": "Name",
                  "type": "string",
                  "placeholder": "Sensor name",
                  "description": "Here set Your own sensor name.",
                  "required": false
                },
                "displayType": {
                  "title": "Type",
                  "type": "integer",
                  "minimum": 0,
                  "maximum": 3,
                  "oneOf": [
                    {
                      "title": "None/Disabled",
                      "enum": [
                        0
                      ]
                    },
                    {
                      "title": "Motion Sensor",
                      "enum": [
                        1
                      ]
                    },
                    {
                      "title": "Occupancy Sensor",
                      "enum": [
                        2
                      ]
                    },
                    {
                      "title": "Contact Sensor",
                      "enum": [
                        3
                      ]
                    }
                  ],
                  "description": "Select the sensor type to be displayed in HomeKit.",
                  "required": true
                }
              },
              "required": false
            },
            "energyProductionLevelSensors": {
              "title": "Sensors",
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "name": {
                    "title": "Name",
                    "type": "string",
                    "placeholder": "Sensor name",
                    "description": "Here set Your own sensor name.",
                    "required": false
                  },
                  "energyLevel": {
                    "title": "Enargy Level",
                    "type": "integer",
                    "minimum": 0,
                    "description": "Here set enargy level in (Wh) at which the sensor fired.",
                    "required": false
                  },
                  "displayType": {
                    "title": "Type",
                    "type": "integer",
                    "minimum": 0,
                    "maximum": 3,
                    "oneOf": [
                      {
                        "title": "None/Disabled",
                        "enum": [
                          0
                        ]
                      },
                      {
                        "title": "Motion Sensor",
                        "enum": [
                          1
                        ]
                      },
                      {
                        "title": "Occupancy Sensor",
                        "enum": [
                          2
                        ]
                      },
                      {
                        "title": "Contact Sensor",
                        "enum": [
                          3
                        ]
                      }
                    ],
                    "description": "Select the sensor type to be displayed in HomeKit.",
                    "required": true
                  }
                }
              },
              "required": false
            },
            "energyProductionLifetimeOffset": {
              "title": "Energy Lifetime Offset",
              "type": "integer",
              "description": "Here set offset in (Wh) for energy production, if nedded.",
              "required": false
            },
            "powerConsumptionTotalStateSensor": {
              "title": "Power State Sensor",
              "type": "object",
              "properties": {
                "name": {
                  "title": "Name",
                  "type": "string",
                  "placeholder": "Sensor name",
                  "description": "Here set Your own sensor name.",
                  "required": false
                },
                "displayType": {
                  "title": "Type",
                  "type": "integer",
                  "minimum": 0,
                  "maximum": 3,
                  "oneOf": [
                    {
                      "title": "None/Disabled",
                      "enum": [
                        0
                      ]
                    },
                    {
                      "title": "Motion Sensor",
                      "enum": [
                        1
                      ]
                    },
                    {
                      "title": "Occupancy Sensor",
                      "enum": [
                        2
                      ]
                    },
                    {
                      "title": "Contact Sensor",
                      "enum": [
                        3
                      ]
                    }
                  ],
                  "description": "Select the sensor type to be displayed in HomeKit.",
                  "required": true
                }
              },
              "required": false
            },
            "powerConsumptionTotalLevelSensors": {
              "title": "Sensors",
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "name": {
                    "title": "Name",
                    "type": "string",
                    "placeholder": "Sensor name",
                    "description": "Here set Your own sensor name.",
                    "required": false
                  },
                  "powerLevel": {
                    "title": "Power Level",
                    "type": "integer",
                    "minimum": 0,
                    "description": "Here set power level in (W) at which the sensor fired.",
                    "required": false
                  },
                  "displayType": {
                    "title": "Type",
                    "type": "integer",
                    "minimum": 0,
                    "maximum": 3,
                    "oneOf": [
                      {
                        "title": "None/Disabled",
                        "enum": [
                          0
                        ]
                      },
                      {
                        "title": "Motion Sensor",
                        "enum": [
                          1
                        ]
                      },
                      {
                        "title": "Occupancy Sensor",
                        "enum": [
                          2
                        ]
                      },
                      {
                        "title": "Contact Sensor",
                        "enum": [
                          3
                        ]
                      }
                    ],
                    "description": "Select the sensor type to be displayed in HomeKit.",
                    "required": true
                  }
                }
              },
              "required": false
            },
            "energyConsumptionTotalLifetimeOffset": {
              "title": "Energy Lifetime Offset",
              "type": "integer",
              "description": "Here set offset in (Wh) for energy consumption total, if nedded.",
              "required": false
            },
            "energyConsumptionTotalStateSensor": {
              "title": "Energy State Sensor",
              "type": "object",
              "properties": {
                "name": {
                  "title": "Name",
                  "type": "string",
                  "placeholder": "Sensor name",
                  "description": "Here set Your own sensor name.",
                  "required": false
                },
                "displayType": {
                  "title": "Type",
                  "type": "integer",
                  "minimum": 0,
                  "maximum": 3,
                  "oneOf": [
                    {
                      "title": "None/Disabled",
                      "enum": [
                        0
                      ]
                    },
                    {
                      "title": "Motion Sensor",
                      "enum": [
                        1
                      ]
                    },
                    {
                      "title": "Occupancy Sensor",
                      "enum": [
                        2
                      ]
                    },
                    {
                      "title": "Contact Sensor",
                      "enum": [
                        3
                      ]
                    }
                  ],
                  "description": "Select the sensor type to be displayed in HomeKit.",
                  "required": true
                }
              },
              "required": false
            },
            "energyConsumptionTotalLevelSensors": {
              "title": "Sensors",
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "name": {
                    "title": "Name",
                    "type": "string",
                    "placeholder": "Sensor name",
                    "description": "Here set Your own sensor name.",
                    "required": false
                  },
                  "energyLevel": {
                    "title": "Enargy Level",
                    "type": "integer",
                    "minimum": 0,
                    "description": "Here set enargy level in (Wh) at which the sensor fired.",
                    "required": false
                  },
                  "displayType": {
                    "title": "Type",
                    "type": "integer",
                    "minimum": 0,
                    "maximum": 3,
                    "oneOf": [
                      {
                        "title": "None/Disabled",
                        "enum": [
                          0
                        ]
                      },
                      {
                        "title": "Motion Sensor",
                        "enum": [
                          1
                        ]
                      },
                      {
                        "title": "Occupancy Sensor",
                        "enum": [
                          2
                        ]
                      },
                      {
                        "title": "Contact Sensor",
                        "enum": [
                          3
                        ]
                      }
                    ],
                    "description": "Select the sensor type to be displayed in HomeKit.",
                    "required": true
                  }
                }
              },
              "required": false
            },
            "powerConsumptionNetStateSensor": {
              "title": "Power State Sensor",
              "type": "object",
              "properties": {
                "name": {
                  "title": "Name",
                  "type": "string",
                  "placeholder": "Sensor name",
                  "description": "Here set Your own sensor name.",
                  "required": false
                },
                "displayType": {
                  "title": "Type",
                  "type": "integer",
                  "minimum": 0,
                  "maximum": 3,
                  "oneOf": [
                    {
                      "title": "None/Disabled",
                      "enum": [
                        0
                      ]
                    },
                    {
                      "title": "Motion Sensor",
                      "enum": [
                        1
                      ]
                    },
                    {
                      "title": "Occupancy Sensor",
                      "enum": [
                        2
                      ]
                    },
                    {
                      "title": "Contact Sensor",
                      "enum": [
                        3
                      ]
                    }
                  ],
                  "description": "Select the sensor type to be displayed in HomeKit.",
                  "required": true
                }
              },
              "required": false
            },
            "powerConsumptionNetLevelSensors": {
              "title": "Sensors",
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "name": {
                    "title": "Name",
                    "type": "string",
                    "placeholder": "Sensor name",
                    "description": "Here set Your own sensor name.",
                    "required": false
                  },
                  "powerLevel": {
                    "title": "Power Level",
                    "type": "integer",
                    "description": "Here set power level in (W) at which the sensor fired, negative value (-) mean exporting energy to the grid.",
                    "required": false
                  },
                  "displayType": {
                    "title": "Type",
                    "type": "integer",
                    "minimum": 0,
                    "maximum": 3,
                    "oneOf": [
                      {
                        "title": "None/Disabled",
                        "enum": [
                          0
                        ]
                      },
                      {
                        "title": "Motion Sensor",
                        "enum": [
                          1
                        ]
                      },
                      {
                        "title": "Occupancy Sensor",
                        "enum": [
                          2
                        ]
                      },
                      {
                        "title": "Contact Sensor",
                        "enum": [
                          3
                        ]
                      }
                    ],
                    "description": "Select the sensor type to be displayed in HomeKit.",
                    "required": true
                  }
                }
              },
              "required": false
            },
            "energyConsumptionNetLifetimeOffset": {
              "title": "Energy Lifetime Offset",
              "type": "integer",
              "description": "Here set offset in (Wh) for energy consumption net, if nedded.",
              "required": false
            },
            "energyConsumptionNetStateSensor": {
              "title": "Energy State Sensor",
              "type": "object",
              "properties": {
                "name": {
                  "title": "Name",
                  "type": "string",
                  "placeholder": "Sensor name",
                  "description": "Here set Your own sensor name.",
                  "required": false
                },
                "displayType": {
                  "title": "Type",
                  "type": "integer",
                  "minimum": 0,
                  "maximum": 3,
                  "oneOf": [
                    {
                      "title": "None/Disabled",
                      "enum": [
                        0
                      ]
                    },
                    {
                      "title": "Motion Sensor",
                      "enum": [
                        1
                      ]
                    },
                    {
                      "title": "Occupancy Sensor",
                      "enum": [
                        2
                      ]
                    },
                    {
                      "title": "Contact Sensor",
                      "enum": [
                        3
                      ]
                    }
                  ],
                  "description": "Select the sensor type to be displayed in HomeKit.",
                  "required": true
                }
              },
              "required": false
            },
            "energyConsumptionNetLevelSensors": {
              "title": "Sensors",
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "name": {
                    "title": "Name",
                    "type": "string",
                    "placeholder": "Sensor name",
                    "description": "Here set Your own sensor name.",
                    "required": false
                  },
                  "energyLevel": {
                    "title": "Energy Level",
                    "type": "integer",
                    "minimum": 0,
                    "description": "Here set energy level in (Wh) at which the sensor fired.",
                    "required": false
                  },
                  "displayType": {
                    "title": "Type",
                    "type": "integer",
                    "minimum": 0,
                    "maximum": 3,
                    "oneOf": [
                      {
                        "title": "None/Disabled",
                        "enum": [
                          0
                        ]
                      },
                      {
                        "title": "Motion Sensor",
                        "enum": [
                          1
                        ]
                      },
                      {
                        "title": "Occupancy Sensor",
                        "enum": [
                          2
                        ]
                      },
                      {
                        "title": "Contact Sensor",
                        "enum": [
                          3
                        ]
                      }
                    ],
                    "description": "Select the sensor type to be displayed in HomeKit.",
                    "required": true
                  }
                }
              },
              "required": false
            },
            "supportProductionPowerMode": {
              "title": "Power Production",
              "type": "boolean",
              "default": false,
              "description": "This enable support to check/control power production, firmware 7.x.x and newer require installer credentials data.",
              "required": false
            },
            "supportPlcLevel": {
              "title": "PLC Level",
              "type": "boolean",
              "default": false,
              "description": "This enable support to check plc level, firmware 7.x.x and newer require installer credentials data.",
              "required": false
            },
            "supportEnchargeProfile": {
              "title": "Profile",
              "type": "boolean",
              "default": false,
              "description": "This enable support to check/control encharge profile, not working yet.",
              "required": false
            },
            "enpowerGridModeSensors": {
              "title": "Enepower Grid Sensors",
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "name": {
                    "title": "Name",
                    "type": "string",
                    "placeholder": "Sensor name",
                    "description": "Here set Your own sensor name.",
                    "required": false
                  },
                  "gridMode": {
                    "title": "Mode",
                    "type": "string",
                    "oneOf": [
                      {
                        "title": "Grid On",
                        "enum": [
                          "on-grid"
                        ]
                      },
                      {
                        "title": "Grid Off",
                        "enum": [
                          "off-grid"
                        ]
                      },
                      {
                        "title": "Multimode Grid On",
                        "enum": [
                          "multimode-ongrid"
                        ]
                      },
                      {
                        "title": "Multimode Grid Off",
                        "enum": [
                          "multimode-offgrid"
                        ]
                      },
                      {
                        "title": "Grid Tied",
                        "enum": [
                          "grid-tied"
                        ]
                      },
                      {
                        "title": "Grid Forming",
                        "enum": [
                          "grid-forming"
                        ]
                      }
                    ],
                    "description": "Here select the grid mode.",
                    "required": true
                  },
                  "displayType": {
                    "title": "Type",
                    "type": "integer",
                    "minimum": 0,
                    "maximum": 3,
                    "oneOf": [
                      {
                        "title": "None/Disabled",
                        "enum": [
                          0
                        ]
                      },
                      {
                        "title": "Motion Sensor",
                        "enum": [
                          1
                        ]
                      },
                      {
                        "title": "Occupancy Sensor",
                        "enum": [
                          2
                        ]
                      },
                      {
                        "title": "Contact Sensor",
                        "enum": [
                          3
                        ]
                      }
                    ],
                    "description": "Select the sensor type to be displayed in HomeKit.",
                    "required": true
                  }
                }
              },
              "required": false
            },
            "enchargeGridModeSensors": {
              "title": "Encharge Grid Sensors",
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "name": {
                    "title": "Name",
                    "type": "string",
                    "placeholder": "Sensor name",
                    "description": "Here set Your own sensor name.",
                    "required": false
                  },
                  "gridMode": {
                    "title": "Mode",
                    "type": "string",
                    "oneOf": [
                      {
                        "title": "Grid On",
                        "enum": [
                          "on-grid"
                        ]
                      },
                      {
                        "title": "Grid Off",
                        "enum": [
                          "off-grid"
                        ]
                      },
                      {
                        "title": "Multimode Grid On",
                        "enum": [
                          "multimode-ongrid"
                        ]
                      },
                      {
                        "title": "Multimode Grid Off",
                        "enum": [
                          "multimode-offgrid"
                        ]
                      },
                      {
                        "title": "Grid Tied",
                        "enum": [
                          "grid-tied"
                        ]
                      },
                      {
                        "title": "Grid Forming",
                        "enum": [
                          "grid-forming"
                        ]
                      }
                    ],
                    "description": "Here select the grid mode.",
                    "required": true
                  },
                  "displayType": {
                    "title": "Type",
                    "type": "integer",
                    "minimum": 0,
                    "maximum": 3,
                    "oneOf": [
                      {
                        "title": "None/Disabled",
                        "enum": [
                          0
                        ]
                      },
                      {
                        "title": "Motion Sensor",
                        "enum": [
                          1
                        ]
                      },
                      {
                        "title": "Occupancy Sensor",
                        "enum": [
                          2
                        ]
                      },
                      {
                        "title": "Contact Sensor",
                        "enum": [
                          3
                        ]
                      }
                    ],
                    "description": "Select the sensor type to be displayed in HomeKit.",
                    "required": true
                  }
                }
              },
              "condition": {
                "functionBody": "return model.devices[arrayIndices].envoyFirmware7xx === true"
              },
              "required": false
            },
            "enchargeBackupLevelSensors": {
              "title": "Encharge Backup Level Sensors",
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "name": {
                    "title": "Name",
                    "type": "string",
                    "placeholder": "Sensor name",
                    "description": "Here set Your own sensor name.",
                    "required": false
                  },
                  "compareMode": {
                    "title": "Compare Mode",
                    "type": "integer",
                    "oneOf": [
                      {
                        "title": ">",
                        "enum": [
                          0
                        ]
                      },
                      {
                        "title": ">=",
                        "enum": [
                          1
                        ]
                      },
                      {
                        "title": "==",
                        "enum": [
                          2
                        ]
                      },
                      {
                        "title": "<",
                        "enum": [
                          3
                        ]
                      },
                      {
                        "title": "<=",
                        "enum": [
                          4
                        ]
                      }
                    ],
                    "description": "Here select the compare mode.",
                    "required": true
                  },
                  "backupLevel": {
                    "title": "Level",
                    "type": "integer",
                    "minimum": 0,
                    "maximum": 100,
                    "multipleOf": 1,
                    "description": "Here set backup level in (%) to compare at which the sensor fired.",
                    "required": false
                  },
                  "displayType": {
                    "title": "Type",
                    "type": "integer",
                    "minimum": 0,
                    "maximum": 3,
                    "oneOf": [
                      {
                        "title": "None/Disabled",
                        "enum": [
                          0
                        ]
                      },
                      {
                        "title": "Motion Sensor",
                        "enum": [
                          1
                        ]
                      },
                      {
                        "title": "Occupancy Sensor",
                        "enum": [
                          2
                        ]
                      },
                      {
                        "title": "Contact Sensor",
                        "enum": [
                          3
                        ]
                      }
                    ],
                    "description": "Select the sensor type to be displayed in HomeKit.",
                    "required": true
                  }
                }
              },
              "condition": {
                "functionBody": "return model.devices[arrayIndices].envoyFirmware7xx === true"
              },
              "required": false
            },
            "solarGridModeSensors": {
              "title": "Solar Grid Sensors",
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "name": {
                    "title": "Name",
                    "type": "string",
                    "placeholder": "Sensor name",
                    "description": "Here set Your own sensor name.",
                    "required": false
                  },
                  "gridMode": {
                    "title": "Mode",
                    "type": "string",
                    "oneOf": [
                      {
                        "title": "Grid On",
                        "enum": [
                          "on-grid"
                        ]
                      },
                      {
                        "title": "Grid Off",
                        "enum": [
                          "off-grid"
                        ]
                      },
                      {
                        "title": "Multimode Grid On",
                        "enum": [
                          "multimode-ongrid"
                        ]
                      },
                      {
                        "title": "Multimode Grid Off",
                        "enum": [
                          "multimode-offgrid"
                        ]
                      },
                      {
                        "title": "Grid Tied",
                        "enum": [
                          "grid-tied"
                        ]
                      },
                      {
                        "title": "Grid Forming",
                        "enum": [
                          "grid-forming"
                        ]
                      }
                    ],
                    "description": "Here select the grid mode.",
                    "required": true
                  },
                  "displayType": {
                    "title": "Type",
                    "type": "integer",
                    "minimum": 0,
                    "maximum": 3,
                    "oneOf": [
                      {
                        "title": "None/Disabled",
                        "enum": [
                          0
                        ]
                      },
                      {
                        "title": "Motion Sensor",
                        "enum": [
                          1
                        ]
                      },
                      {
                        "title": "Occupancy Sensor",
                        "enum": [
                          2
                        ]
                      },
                      {
                        "title": "Contact Sensor",
                        "enum": [
                          3
                        ]
                      }
                    ],
                    "description": "Select the sensor type to be displayed in HomeKit.",
                    "required": true
                  }
                }
              },
              "condition": {
                "functionBody": "return model.devices[arrayIndices].envoyFirmware7xx === true"
              },
              "required": false
            },
            "dataRefreshSensor": {
              "title": "Data Refresh Sensor",
              "type": "object",
              "properties": {
                "name": {
                  "title": "Name",
                  "type": "string",
                  "placeholder": "Sensor name",
                  "description": "Here set Your own sensor name.",
                  "required": false
                },
                "displayType": {
                  "title": "Type",
                  "type": "integer",
                  "minimum": 0,
                  "maximum": 3,
                  "oneOf": [
                    {
                      "title": "None/Disabled",
                      "enum": [
                        0
                      ]
                    },
                    {
                      "title": "Motion Sensor",
                      "enum": [
                        1
                      ]
                    },
                    {
                      "title": "Occupancy Sensor",
                      "enum": [
                        2
                      ]
                    },
                    {
                      "title": "Contact Sensor",
                      "enum": [
                        3
                      ]
                    }
                  ],
                  "description": "Select the sensor type to be displayed in HomeKit.",
                  "required": true
                }
              },
              "required": false
            },
            "metersDataRefreshTime": {
              "title": "Meters Refresh Time",
              "type": "number",
              "minimum": 0.5,
              "maximum": 60,
              "multipleOf": 0.5,
              "description": "Here set meters data refresh time in (sec).",
              "required": false
            },
            "productionDataRefreshTime": {
              "title": "Production Refresh Time",
              "type": "number",
              "minimum": 0.5,
              "maximum": 60,
              "multipleOf": 0.5,
              "description": "Here set production data rfresh time in (sec).",
              "required": false
            },
            "liveDataRefreshTime": {
              "title": "Live Data Refresh Time",
              "type": "number",
              "minimum": 0.5,
              "maximum": 60,
              "multipleOf": 0.5,
              "description": "Here set live data refresh time in (sec).",
              "condition": {
                "functionBody": "return model.devices[arrayIndices].envoyFirmware7xx === true"
              },
              "required": false
            },
            "ensembleDataRefreshTime": {
              "title": "Ensemble Refresh Time",
              "type": "number",
              "minimum": 0.5,
              "maximum": 60,
              "multipleOf": 0.5,
              "description": "Here set ensemble data refresh time in (sec).",
              "condition": {
                "functionBody": "return model.devices[arrayIndices].envoyFirmware7xx === true"
              },
              "required": false
            },
            "enableDebugMode": {
              "title": "Debug",
              "type": "boolean",
              "default": false,
              "description": "This enable debug mode.",
              "required": false
            },
            "disableLogInfo": {
              "title": "Disable Log Info",
              "type": "boolean",
              "default": false,
              "description": "This disable log info, all values and state will not be displayed in Homebridge log console.",
              "required": false
            },
            "disableLogDeviceInfo": {
              "title": "Disable Log Device Info",
              "type": "boolean",
              "default": false,
              "description": "This disable log device info by every connections device to the network.",
              "required": false
            },
            "enableRestFul": {
              "title": "Enable",
              "type": "boolean",
              "default": false,
              "description": "This enable RESTful server."
            },
            "restFulDebug": {
              "title": "Debug",
              "type": "boolean",
              "default": false,
              "description": "This enable debug mode for RESTFul.",
              "condition": {
                "functionBody": "return model.devices[arrayIndices].enableRestFul === true;"
              },
              "required": false
            },
            "restFulPort": {
              "title": "Port",
              "type": "integer",
              "placeholder": 3000,
              "description": "Here set the listening Port for RESTful server.",
              "condition": {
                "functionBody": "return model.devices[arrayIndices].enableRestFul === true;"
              },
              "required": false
            },
            "enableMqtt": {
              "title": "Enable",
              "type": "boolean",
              "default": false,
              "description": "This enable MQTT client.",
              "required": false
            },
            "mqttDebug": {
              "title": "Debug",
              "type": "boolean",
              "default": false,
              "description": "This enable debug mode for MQTT.",
              "condition": {
                "functionBody": "return model.devices[arrayIndices].enableMqtt === true;"
              },
              "required": false
            },
            "mqttHost": {
              "title": "IP/Hostname",
              "type": "string",
              "placeholder": "ip or hostname",
              "format": "hostname",
              "description": "Here set the IP/Hostname of MQTT Broker.",
              "condition": {
                "functionBody": "return model.devices[arrayIndices].enableMqtt === true;"
              },
              "required": false
            },
            "mqttPort": {
              "title": "Port",
              "type": "integer",
              "placeholder": 1883,
              "description": "Here set the port of MQTT Broker.",
              "condition": {
                "functionBody": "return model.devices[arrayIndices].enableMqtt === true;"
              },
              "required": false
            },
            "mqttClientId": {
              "title": "Client ID",
              "type": "string",
              "placeholder": "client id",
              "description": "Here optional set the Client ID of MQTT Broker.",
              "condition": {
                "functionBody": "return model.devices[arrayIndices].enableMqtt === true"
              },
              "required": false
            },
            "mqttPrefix": {
              "title": "Prefix",
              "type": "string",
              "placeholder": "home/envoy",
              "description": "Here set the prefix.",
              "condition": {
                "functionBody": "return model.devices[arrayIndices].enableMqtt === true;"
              },
              "required": false
            },
            "mqttAuth": {
              "title": "Authorization",
              "type": "boolean",
              "default": false,
              "description": "This enable authorization for MQTT Broker.",
              "condition": {
                "functionBody": "return model.devices[arrayIndices].enableMqtt === true;"
              },
              "required": false
            },
            "mqttUser": {
              "title": "User",
              "type": "string",
              "placeholder": "user",
              "description": "Here set the user of MQTT Broker.",
              "condition": {
                "functionBody": "return model.devices[arrayIndices].enableMqtt === true && model.devices[arrayIndices].mqttAuth === true;"
              },
              "required": false
            },
            "mqttPasswd": {
              "title": "Password",
              "type": "string",
              "placeholder": "password",
              "description": "Here set the password of MQTT Broker.",
              "condition": {
                "functionBody": "return model.devices[arrayIndices].enableMqtt === true && model.devices[arrayIndices].mqttAuth === true;"
              },
              "required": false
            }
          }
        }
      }
    }
  },
  "layout": [
    {
      "key": "devices",
      "type": "tabarray",
      "title": "{{ value.name || 'system' }}",
      "items": [
        "devices[].name",
        "devices[].host",
        {
          "key": "devices[]",
          "type": "section",
          "title": "Advanced Settings",
          "expandable": true,
          "expanded": false,
          "items": [
            {
              "key": "devices[]",
              "type": "tabarray",
              "title": "{{ value.title }}",
              "items": [
                {
                  "key": "devices[]",
                  "title": "Envoy",
                  "items": [
                    "devices[].envoyFirmware7xx",
                    "devices[].envoyFirmware7xxTokenGenerationMode",
                    "devices[].envoyToken",
                    "devices[].envoyPasswd",
                    "devices[].envoySerialNumber",
                    "devices[].enlightenUser",
                    "devices[].enlightenPasswd",
                    "devices[].supportProductionPowerMode",
                    "devices[].supportPlcLevel"
                  ],
                  "description": "Here You can configure envoy gateway."
                },
                {
                  "key": "devices[]",
                  "title": "Production",
                  "items": [
                    {
                      "key": "devices[]",
                      "type": "tabarray",
                      "title": "{{ value.title }}",
                      "items": [
                        {
                          "key": "devices[]",
                          "title": "Power",
                          "items": [
                            "devices[].powerProductionSummary",
                            {
                              "key": "devices[].powerProductionStateSensor",
                              "type": "section",
                              "title": "Power State Sensor",
                              "description": "In this section You can enable sensor for power state monitoring and expose it in HomeKit.",
                              "items": [
                                "devices[].powerProductionStateSensor.name",
                                "devices[].powerProductionStateSensor.displayType"
                              ]
                            },
                            {
                              "key": "devices[]",
                              "type": "section",
                              "title": "Power Level Sensors",
                              "description": "In this section You can create multiple sensors for power level monitoring and expose it in HomeKit.",
                              "expandable": true,
                              "expanded": false,
                              "items": [
                                {
                                  "key": "devices[].powerProductionLevelSensors",
                                  "type": "tabarray",
                                  "title": "{{ value.name || 'sensor' }}",
                                  "items": [
                                    "devices[].powerProductionLevelSensors[].name",
                                    "devices[].powerProductionLevelSensors[].powerLevel",
                                    "devices[].powerProductionLevelSensors[].displayType"
                                  ]
                                }
                              ]
                            }
                          ]
                        },
                        {
                          "key": "devices[]",
                          "title": "Energy",
                          "items": [
                            "devices[].energyProductionLifetimeOffset",
                            {
                              "key": "devices[].energyProductionStateSensor",
                              "type": "section",
                              "title": "Energy State Sensor",
                              "description": "In this section You can enable sensor for energy state monitoring and expose it in HomeKit.",
                              "items": [
                                "devices[].energyProductionStateSensor.name",
                                "devices[].energyProductionStateSensor.displayType"
                              ]
                            },
                            {
                              "key": "devices[]",
                              "type": "section",
                              "title": "Energy Level Sensors",
                              "description": "In this section You can create multiple sensors for energy level monitoring and expose it in HomeKit.",
                              "expandable": true,
                              "expanded": false,
                              "items": [
                                {
                                  "key": "devices[].energyProductionLevelSensors",
                                  "type": "tabarray",
                                  "title": "{{ value.name || 'sensor' }}",
                                  "items": [
                                    "devices[].energyProductionLevelSensors[].name",
                                    "devices[].energyProductionLevelSensors[].energyLevel",
                                    "devices[].energyProductionLevelSensors[].displayType"
                                  ]
                                }
                              ]
                            }
                          ]
                        }
                      ]
                    }
                  ]
                },
                {
                  "key": "devices[]",
                  "title": "Consumption",
                  "items": [
                    {
                      "key": "devices[]",
                      "type": "tabarray",
                      "title": "{{ value.title }}",
                      "items": [
                        {
                          "key": "devices[]",
                          "title": "Total",
                          "items": [
                            {
                              "key": "devices[]",
                              "type": "tabarray",
                              "title": "{{ value.title }}",
                              "items": [
                                {
                                  "key": "devices[]",
                                  "title": "Power",
                                  "items": [
                                    {
                                      "key": "devices[].powerConsumptionTotalStateSensor",
                                      "type": "section",
                                      "title": "Power State Sensor",
                                      "description": "In this section You can enable sensor for power state monitoring and expose it in HomeKit.",
                                      "items": [
                                        "devices[].powerConsumptionTotalStateSensor.name",
                                        "devices[].powerConsumptionTotalStateSensor.displayType"
                                      ]
                                    },
                                    {
                                      "key": "devices[]",
                                      "type": "section",
                                      "title": "Power Level Sensors",
                                      "description": "In this section You can create multiple sensors for power level monitoring and expose it in HomeKit.",
                                      "expandable": true,
                                      "expanded": false,
                                      "items": [
                                        {
                                          "key": "devices[].powerConsumptionTotalLevelSensors",
                                          "type": "tabarray",
                                          "title": "{{ value.name || 'sensor' }}",
                                          "items": [
                                            "devices[].powerConsumptionTotalLevelSensors[].name",
                                            "devices[].powerConsumptionTotalLevelSensors[].powerLevel",
                                            "devices[].powerConsumptionTotalLevelSensors[].displayType"
                                          ]
                                        }
                                      ]
                                    }
                                  ]
                                },
                                {
                                  "key": "devices[]",
                                  "title": "Energy",
                                  "items": [
                                    "devices[].energyConsumptionTotalLifetimeOffset",
                                    {
                                      "key": "devices[].energyConsumptionTotalStateSensor",
                                      "type": "section",
                                      "title": "Energy State Sensor",
                                      "description": "In this section You can enable sensor for energy state monitoring and expose it in HomeKit.",
                                      "items": [
                                        "devices[].energyConsumptionTotalStateSensor.name",
                                        "devices[].energyConsumptionTotalStateSensor.displayType"
                                      ]
                                    },
                                    {
                                      "key": "devices[]",
                                      "type": "section",
                                      "title": "Energy Level Sensors",
                                      "description": "In this section You can create multiple sensors for energy level monitoring and expose it in HomeKit.",
                                      "expandable": true,
                                      "expanded": false,
                                      "items": [
                                        {
                                          "key": "devices[].energyConsumptionTotalLevelSensors",
                                          "type": "tabarray",
                                          "title": "{{ value.name || 'sensor' }}",
                                          "items": [
                                            "devices[].energyConsumptionTotalLevelSensors[].name",
                                            "devices[].energyConsumptionTotalLevelSensors[].energyLevel",
                                            "devices[].energyConsumptionTotalLevelSensors[].displayType"
                                          ]
                                        }
                                      ]
                                    }
                                  ]
                                }
                              ]
                            }
                          ]
                        },
                        {
                          "key": "devices[]",
                          "title": "Net",
                          "items": [
                            {
                              "key": "devices[]",
                              "type": "tabarray",
                              "title": "{{ value.title }}",
                              "items": [
                                {
                                  "key": "devices[]",
                                  "title": "Power",
                                  "items": [
                                    {
                                      "key": "devices[].powerConsumptionNetStateSensor",
                                      "type": "section",
                                      "title": "Power State Sensor",
                                      "description": "In this section You can enable sensor for power state monitoring and expose it in HomeKit.",
                                      "items": [
                                        "devices[].powerConsumptionNetStateSensor.name",
                                        "devices[].powerConsumptionNetStateSensor.displayType"
                                      ]
                                    },
                                    {
                                      "key": "devices[]",
                                      "type": "section",
                                      "title": "Power Level Sensors",
                                      "description": "In this section You can create multiple sensors for power level monitoring and expose it in HomeKit.",
                                      "expandable": true,
                                      "expanded": false,
                                      "items": [
                                        {
                                          "key": "devices[].powerConsumptionNetLevelSensors",
                                          "type": "tabarray",
                                          "title": "{{ value.name || 'sensor' }}",
                                          "items": [
                                            "devices[].powerConsumptionNetLevelSensors[].name",
                                            "devices[].powerConsumptionNetLevelSensors[].powerLevel",
                                            "devices[].powerConsumptionNetLevelSensors[].displayType"
                                          ]
                                        }
                                      ]
                                    }
                                  ]
                                },
                                {
                                  "key": "devices[]",
                                  "title": "Energy",
                                  "items": [
                                    "devices[].energyConsumptionNetLifetimeOffset",
                                    {
                                      "key": "devices[].energyConsumptionNetStateSensor",
                                      "type": "section",
                                      "title": "Energy State Sensor",
                                      "description": "In this section You can enable sensor for energy state monitoring and expose it in HomeKit.",
                                      "items": [
                                        "devices[].energyConsumptionNetStateSensor.name",
                                        "devices[].energyConsumptionNetStateSensor.displayType"
                                      ]
                                    },
                                    {
                                      "key": "devices[]",
                                      "type": "section",
                                      "title": "Energy Level Sensors",
                                      "description": "In this section You can create multiple sensors for energy level monitoring and expose it in HomeKit.",
                                      "expandable": true,
                                      "expanded": false,
                                      "items": [
                                        {
                                          "key": "devices[].energyConsumptionNetLevelSensors",
                                          "type": "tabarray",
                                          "title": "{{ value.name || 'sensor' }}",
                                          "items": [
                                            "devices[].energyConsumptionNetLevelSensors[].name",
                                            "devices[].energyConsumptionNetLevelSensors[].energyLevel",
                                            "devices[].energyConsumptionNetLevelSensors[].displayType"
                                          ]
                                        }
                                      ]
                                    }
                                  ]
                                }
                              ]
                            }
                          ]
                        }
                      ]
                    }
                  ]
                },
                {
                  "key": "devices[]",
                  "title": "Ensemble",
                  "items": [
                    {
                      "key": "devices[]",
                      "type": "tabarray",
                      "title": "{{ value.title }}",
                      "items": [
                        {
                          "key": "devices[]",
                          "title": "Enpower",
                          "items": [
                            {
                              "key": "devices[]",
                              "type": "section",
                              "title": "Grid Mode Sensors",
                              "description": "In this section You can create sensors for enpower grid mode monitoring and expose it in HomeKit. If grid mode matches, the contact fired.",
                              "expandable": true,
                              "expanded": false,
                              "items": [
                                {
                                  "key": "devices[].enpowerGridModeSensors",
                                  "type": "tabarray",
                                  "title": "{{ value.name || 'sensor' }}",
                                  "items": [
                                    "devices[].enpowerGridModeSensors[].name",
                                    "devices[].enpowerGridModeSensors[].gridMode",
                                    "devices[].enpowerGridModeSensors[].displayType"
                                  ]
                                }
                              ]
                            }
                          ]
                        },
                        {
                          "key": "devices[]",
                          "title": "Encharge",
                          "items": [
                            "devices[].supportEnchargeProfile",
                            {
                              "key": "devices[]",
                              "type": "section",
                              "title": "Grid Mode Sensors",
                              "description": "In this section You can enable sensor for encharge grid mode monitoring and expose it in HomeKit. If grid mode matches, the contact fired.",
                              "expandable": true,
                              "expanded": false,
                              "items": [
                                {
                                  "key": "devices[].enchargeGridModeSensors",
                                  "type": "tabarray",
                                  "title": "{{ value.name || 'sensor' }}",
                                  "items": [
                                    "devices[].enchargeGridModeSensors[].name",
                                    "devices[].enchargeGridModeSensors[].gridMode",
                                    "devices[].enchargeGridModeSensors[].displayType"
                                  ]
                                }
                              ]
                            },
                            {
                              "key": "devices[]",
                              "type": "section",
                              "title": "Backup Level Sensors",
                              "description": "In this section You can enable sensor for encharge backup level and expose it in HomeKit. If backup level matches, the contact fired.",
                              "expandable": true,
                              "expanded": false,
                              "items": [
                                {
                                  "key": "devices[].enchargeBackupLevelSensors",
                                  "type": "tabarray",
                                  "title": "{{ value.name || 'sensor' }}",
                                  "items": [
                                    "devices[].enchargeBackupLevelSensors[].name",
                                    "devices[].enchargeBackupLevelSensors[].compareMode",
                                    "devices[].enchargeBackupLevelSensors[].backupLevel",
                                    "devices[].enchargeBackupLevelSensors[].displayType"
                                  ]
                                }
                              ]
                            }
                          ]
                        },
                        {
                          "key": "devices[]",
                          "title": "Solar",
                          "items": [
                            {
                              "key": "devices[]",
                              "type": "section",
                              "title": "Grid Mode Sensors",
                              "description": "In this section You can enable sensor for solar grid mode monitoring and expose it in HomeKit. If grid mode matches, the contact fired.",
                              "expandable": true,
                              "expanded": false,
                              "items": [
                                {
                                  "key": "devices[].solarGridModeSensors",
                                  "type": "tabarray",
                                  "title": "{{ value.name || 'sensor' }}",
                                  "items": [
                                    "devices[].solarGridModeSensors[].name",
                                    "devices[].solarGridModeSensors[].gridMode",
                                    "devices[].solarGridModeSensors[].displayType"
                                  ]
                                }
                              ]
                            }
                          ]
                        }
                      ]
                    }
                  ]
                },
                {
                  "key": "devices[]",
                  "title": "System",
                  "description": "Here You can configure system settings.",
                  "items": [
                    "devices[].enableDebugMode",
                    "devices[].disableLogInfo",
                    "devices[].disableLogDeviceInfo",
                    "devices[].metersDataRefreshTime",
                    "devices[].productionDataRefreshTime",
                    "devices[].liveDataRefreshTime",
                    "devices[].ensembleDataRefreshTime",
                    {
                      "key": "devices[].dataRefreshSensor",
                      "type": "section",
                      "title": "Data Refresh Sensor",
                      "description": "In this section You can enable sensor for system data refresh monitoring and expose it in HomeKit.",
                      "items": [
                        "devices[].dataRefreshSensor.name",
                        "devices[].dataRefreshSensor.displayType"
                      ]
                    }
                  ]
                },
                {
                  "key": "devices[]",
                  "title": "External Integrations",
                  "items": [
                    {
                      "key": "devices[]",
                      "type": "tabarray",
                      "title": "{{ value.title }}",
                      "items": [
                        {
                          "key": "devices[]",
                          "title": "RESTFul",
                          "items": [
                            "devices[].enableRestFul",
                            "devices[].restFulDebug",
                            "devices[].restFulPort"
                          ]
                        },
                        {
                          "key": "devices[]",
                          "title": "MQTT",
                          "items": [
                            "devices[].enableMqtt",
                            "devices[].mqttDebug",
                            "devices[].mqttHost",
                            "devices[].mqttPort",
                            "devices[].mqttClientId",
                            "devices[].mqttPrefix",
                            "devices[].mqttAuth",
                            "devices[].mqttUser",
                            "devices[].mqttPasswd"
                          ]
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        }
      ]
    }
  ]
}